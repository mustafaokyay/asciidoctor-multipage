<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Java</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="java-persistence-api" class="article">
<div id="header">
<h1>Java</h1>
</div>
<div id="content">
<div class="sect2">
<h3 id="java-persistence-api">7. Java Persistence API</h3>
<div class="paragraph">
<p>For mapping java objects to a relational database we use the <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a>.
As JPA implementation we recommend to use <a href="http://hibernate.org/orm/">Hibernate</a>. For general documentation about JPA and Hibernate follow the links above as we will not replicate the documentation. Here you will only find guidelines and examples how we recommend to use it properly. The following examples show how to map the data of a database to an entity. As we use JPA we abstract from <a href="guide-sql.asciidoc">SQL</a> here. However, you will still need a <a href="https://en.wikipedia.org/wiki/Data_definition_language">DDL</a> script for your schema and during maintenance also <a href="guide-database-migration.asciidoc">database migrations</a>. Please follow our <a href="guide-sql.asciidoc">SQL guide</a> for such artifacts.</p>
</div>
<div class="sect3">
<h4 id="entity">7.1. Entity</h4>
<div class="paragraph">
<p>Entities are part of the persistence layer and contain the actual data. They are POJOs (Plain Old Java Objects) on which the relational data of a database is mapped and vice versa. The mapping is configured via JPA annotations (<code>javax.persistence</code>). Usually an entity class corresponds to a table of a database and a property to a column of that table. A persistent entity instance then represents a row of the database table.</p>
</div>
<div class="sect4">
<h5 id="a-simple-entity">A Simple Entity</h5>
<div class="paragraph">
<p>The following listing shows a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
@Table(name="TEXTMESSAGE")
public class MessageEntity extends ApplicationPersistenceEntity implements Message {

  private String text;

  public String getText() {
    return this.text;
  }

  public void setText(String text) {
    this.text = text;
  }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Entity</code> annotation defines that instances of this class will be entities which can be stored in the database. The <code>@Table</code> annotation is optional and can be used to define the name of the corresponding table in the database. If it is not specified, the simple name of the entity class is used instead.</p>
</div>
<div class="paragraph">
<p>In order to specify how to map the attributes to columns we annotate the corresponding getter methods (technically also private field annotation is also possible but approaches can not be mixed).
The <code>@Id</code> annotation specifies that a property should be used as <a href="#primary-keys">primary key</a>.
With the help of the <code>@Column</code> annotation it is possible to define the name of the column that an attribute is mapped to as well as other aspects such as <code>nullable</code> or <code>unique</code>. If no column name is specified, the name of the property is used as default.</p>
</div>
<div class="paragraph">
<p>Note that every entity class needs a constructor with public or protected visibility that does not have any arguments. Moreover, neither the class nor its getters and setters may be final.</p>
</div>
<div class="paragraph">
<p>Entities should be simple POJOs and not contain business logic.</p>
</div>
</div>
<div class="sect4">
<h5 id="entities-and-datatypes">Entities and Datatypes</h5>
<div class="paragraph">
<p>Standard datatypes like <code>Integer</code>, <code>BigDecimal</code>, <code>String</code>, etc. are mapped automatically by JPA. Custom <a href="guide-datatype.asciidoc">datatypes</a> are mapped as serialized <a href="#blob">BLOB</a> by default what is typically undesired.
In order to map atomic custom datatypes (implementations of`+SimpleDatatype`) we implement an <code>AttributeConverter</code>. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Converter(autoApply = true)
public class MoneyAttributeConverter implements AttributeConverter&lt;Money, BigDecimal&gt; {

  public BigDecimal convertToDatabaseColumn(Money attribute) {
    return attribute.getValue();
  }

  public Money convertToEntityAttribute(BigDecimal dbData) {
    return new Money(dbData);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation <code>@Converter</code> is detected by the JPA vendor if the annotated class is in the packages to scan. Further, <code>autoApply = true</code> implies that the converter is automatically used for all properties of the handled datatype. Therefore all entities with properties of that datatype will automatically be mapped properly (in our example <code>Money</code> is mapped as <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p>In case you have a composite datatype that you need to map to multiple columns the JPA does not offer a real solution. As a workaround you can use a bean instead of a real datatype and declare it as <a href="#embeddable"><code>@Embeddable</code></a>. If you are using Hibernate you can implement <code>CompositeUserType</code>. Via the <code>@TypeDef</code> annotation it can be registered to Hibernate. If you want to annotate the <code>CompositeUserType</code> implementation itself you also need another annotation (e.g. <code>MappedSuperclass</code> tough not technically correct) so it is found by the scan.</p>
</div>
<div class="sect5">
<h6 id="enumerations">Enumerations</h6>
<div class="paragraph">
<p>By default JPA maps Enums via their ordinal. Therefore the database will only contain the ordinals (0, 1, 2, etc.) . So , inside the database you can not easily understand their meaning. Using <code>@Enumerated</code> with <code>EnumType.STRING</code> allows to map the enum values to their name (<code>Enum.name()</code>). Both approaches are fragile when it comes to code changes and refactoring (if you change the order of the enum values or rename them) after the application is deployed to production. If you want to avoid this and get a robust mapping you can define a dedicated string in each enum value for database representation that you keep untouched. Then you treat the enum just like any other <a href="#entities-and-datatypes">custom datatype</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="blob">BLOB</h6>
<div class="paragraph">
<p>If binary or character large objects (BLOB/CLOB) should be used to store the value of an attribute, e.g. to store an icon, the <code>@Lob</code> annotation should be used as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Lob
public byte[] getIcon() {
  return this.icon;
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Using a byte array will cause problems if BLOBs get large because the entire BLOB is loaded into the RAM of the server and has to be processed by the garbage collector. For larger BLOBs the type <a href="http://docs.oracle.com/javase/7/docs/api/java/sql/Blob.html">Blob</a> and <a href="guide-blob-support.asciidoc">streaming</a> should be used.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public Blob getAttachment() {
  return this.attachment;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="date-and-time">Date and Time</h6>
<div class="paragraph">
<p>To store date and time related values, the temporal annotation can be used as shown in the listing below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Temporal(TemporalType.TIMESTAMP)
public java.util.Date getStart() {
  return start;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Until Java8 the java data type <code>java.util.Date</code> (or Jodatime) has to be used.
<code>TemporalType</code> defines the granularity. In this case, a precision of nanoseconds is used. If this granularity is not wanted, <code>TemporalType.DATE</code> can be used instead, which only has a granularity of milliseconds.
Mixing these two granularities can cause problems when comparing one value to another. This is why we <strong>only</strong>  use <code>TemporalType.TIMESTAMP</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="querydsl-and-custom-types">QueryDSL and Custom Types</h6>
<div class="paragraph">
<p>Using the Aliases API of QueryDSL might result in an <code>InvalidDataAccessApiUsageException</code> when using custom datatypes in entity properties. This can be circumvented in two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you have the following maven dependencies in your project (<code>core</code> module) to support custom types via the Aliases API:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
  &lt;artifactId&gt;asm&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;cglib&lt;/groupId&gt;
  &lt;artifactId&gt;cglib&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure, that all your custom types used in entities provide a non-argument constructor with at least visibility level <code>protected</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="primary-keys">Primary Keys</h5>
<div class="paragraph">
<p>We only use simple Long values as primary keys (IDs). By default it is auto generated (<code>@GeneratedValue(strategy=GenerationType.AUTO)</code>). This is already provided by the class <code>com.devonfw.&lt;projectName&gt;.general.dataaccess.api.AbstractPersistenceEntity</code> within the <a href="guide-structure-classic.asciidoc#architecture-mapping">classic project structure</a> respectively <code>com.devonfw.&lt;projectName&gt;.general.domain.model.AbstractPersistenceEntity</code> within the <a href="guide-structure-modern.asciidoc#architecture-mapping">modern project structure</a>, that you can extend.
In case you have business oriented keys (often as <code>String</code>), you can define an additional property for it and declare it as unique (<code>@Column(unique=true)</code>).
Be sure to include "AUTO_INCREMENT" in your sql table field ID to be able to persist data (or similar for other databases).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="relationships">7.2. Relationships</h4>
<div class="sect4">
<h5 id="n1-and-11-relationships">n:1 and 1:1 Relationships</h5>
<div class="paragraph">
<p>Entities often do not exist independently but are in some relation to each other. For example, for every period of time one of the StaffMember&#8217;s of the restaurant example has worked, which is represented by the class <code>WorkingTime</code>, there is a relationship to this StaffMember.</p>
</div>
<div class="paragraph">
<p>The following listing shows how this can be modeled using JPA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">...

@Entity
public class WorkingTimeEntity {
   ...

   private StaffMemberEntity staffMember;

   @ManyToOne
   @JoinColumn(name="STAFFMEMBER")
   public StaffMemberEntity getStaffMember() {
      return this.staffMember;
   }

   public void setStaffMember(StaffMemberEntity staffMember) {
      this.staffMember = staffMember;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To represent the relationship, an attribute of the type of the corresponding entity class that is referenced has been introduced. The relationship is a n:1 relationship, because every <code>WorkingTime</code> belongs to exactly one <code>StaffMember</code>, but a <code>StaffMember</code> usually worked more often than once.<br>
This is why the <code>@ManyToOne</code> annotation is used here. For 1:1 relationships the <code>@OneToOne</code> annotation can be used which works basically the same way. To be able to save information about the relation in the database, an additional column in the corresponding table of WorkingTime is needed which contains the primary key of the referenced StaffMember. With the <code>name</code> element of the <code>@JoinColumn</code> annotation it is possible to specify the name of this column.</p>
</div>
</div>
<div class="sect4">
<h5 id="1n-and-nm-relationships">1:n and n:m Relationships</h5>
<div class="paragraph">
<p>The relationship of the example listed above is currently an unidirectional one, as there is a getter method for retrieving the <code>StaffMember</code> from the <code>WorkingTime</code> object, but not vice versa.</p>
</div>
<div class="paragraph">
<p>To make it a bidirectional one, the following code has to be added to <code>StaffMember</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private Set&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy="staffMember")
  public Set&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(Set&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the relationship bidirectional, the tables in the database do not have to be changed. Instead the column that corresponds to the attribute <code>staffMember</code> in class <code>WorkingTime</code> is used, which is specified by the <code>mappedBy</code> element of the <code>@OneToMany</code> annotation. Hibernate will search for corresponding <code>WorkingTime</code> objects automatically when a <code>StaffMember</code> is loaded.</p>
</div>
<div class="paragraph">
<p>The problem with bidirectional relationships is that if a <code>WorkingTime</code> object is added to the set or list <code>workingTimes</code> in <code>StaffMember</code>, this does not have any effect in the database unless
the <code>staffMember</code> attribute of that <code>WorkingTime</code> object is set. That is why the devon4j advices not to use bidirectional relationships but to use queries instead. How to do this is shown <a href="#queries">here</a>. If a bidirectional relationship should be used nevertheless, appropriate add and remove methods must be used.</p>
</div>
<div class="paragraph">
<p>For 1:n and n:m relations, the devon4j demands that (unordered) Sets and no other collection types are used, as shown in the listing above. The only exception is whenever an ordering is really needed, (sorted) lists can be used.<br>
For example, if <code>WorkingTime</code> objects should be sorted by their start time, this could be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private List&lt;WorkingTimeEntity&gt; workingTimes;

  @OneToMany(mappedBy = "staffMember")
  @OrderBy("startTime asc")
  public List&lt;WorkingTimeEntity&gt; getWorkingTimes() {
    return this.workingTimes;
  }

  public void setWorkingTimes(List&lt;WorkingTimeEntity&gt; workingTimes) {
    this.workingTimes = workingTimes;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>@OrderBy</code> annotation consists of an attribute name of the class followed by <code>asc</code> (ascending) or <code>desc</code> (descending).</p>
</div>
<div class="paragraph">
<p>To store information about a n:m relationship, a separate table has to be used, as one column cannot store several values (at least if the database schema is in first normal form).<br>
For example if one wanted to extend the example application so that all ingredients of one <code>FoodDrink</code> can be saved and to model the ingredients themselves as entities (e.g. to store additional information about them), this could be modeled as follows (extract of class <code>FoodDrink</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private Set&lt;IngredientEntity&gt; ingredients;

  @ManyToMany()
  @JoinTable
  public Set&lt;IngredientEntity&gt; getIngredients() {
    return this.ingredients;
  }

  public void setOrders(Set&lt;IngredientEntity&gt; ingredients) {
    this.ingredients = ingredients;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Information about the relation is stored in a table called <code>BILL_ORDER</code> that has to have two columns, one for referencing the Bill, the other one for referencing the Order. Note that the <code>@JoinTable</code> annotation is not needed in this case because a separate table is the default solution here (same for n:m relations) unless there is a <code>mappedBy</code> element specified.</p>
</div>
<div class="paragraph">
<p>For 1:n relationships this solution has the disadvantage that more joins (in the database system) are needed to get a Bill with all the Orders it refers to. This might have a negative impact on performance so that the solution to store a reference to the Bill row/entity in the Order&#8217;s table is probably the better solution in most cases.</p>
</div>
<div class="paragraph">
<p>Note that bidirectional n:m relationships are not allowed for applications based on devon4j. Instead a third entity has to be introduced, which "represents" the relationship (it has two n:1 relationships).</p>
</div>
</div>
<div class="sect4">
<h5 id="eager-vs-lazy-loading">Eager vs. Lazy Loading</h5>
<div class="paragraph">
<p>Using JPA it is possible to use either lazy or eager loading. Eager loading means that for entities retrieved from the database, other entities that are referenced by these entities are also retrieved, whereas lazy loading means that this is only done when they are actually needed, i.e. when the corresponding getter method is invoked.</p>
</div>
<div class="paragraph">
<p>Application based on devon4j are strongly advised to <strong>always use lazy loading</strong>. The JPA defaults are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@OneToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToMany</code>: LAZY</p>
</li>
<li>
<p><code>@ManyToOne</code>: EAGER</p>
</li>
<li>
<p><code>@OneToOne</code>: EAGER</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So at least for <code>@ManyToOne</code> and <code>@OneToOne</code> you always need to override the default by providing <code>fetch = FetchType.LAZY</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Please read the <a href="guide-jpa-performance.asciidoc">performance guide</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cascading-relationships">Cascading Relationships</h5>
<div class="paragraph">
<p>For relations it is also possible to define whether operations are cascaded (like a recursion) to the related entity.
By default, nothing is done in these situations. This can be changed by using the <code>cascade</code> property of the annotation that specifies the relation type (<code>@OneToOne</code>, <code>@ManyToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>). This property accepts a <code>CascadeType</code> that offers the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PERSIST (for <code>EntityManager.persist</code>, relevant to inserted transient entities into DB)</p>
</li>
<li>
<p>REMOVE (for <code>EntityManager.remove</code> to delete entity from DB)</p>
</li>
<li>
<p>MERGE (for <code>EntityManager.merge</code>)</p>
</li>
<li>
<p>REFRESH (for <code>EntityManager.refresh</code>)</p>
</li>
<li>
<p>DETACH (for <code>EntityManager.detach</code>)</p>
</li>
<li>
<p>ALL (cascade all of the above operations)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="http://meri-stuff.blogspot.de/2012/03/jpa-tutorial.html">here</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="typesafe-foreign-keys-using-idref">Typesafe Foreign Keys using IdRef</h5>
<div class="paragraph">
<p>For simple usage you can use <code>Long</code> for all your foreign keys.
However, as an optional pattern for advanced and type-safe usage, we offer <a href="guide-jpa-idref.asciidoc">IdRef</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable">7.3. Embeddable</h4>
<div class="paragraph">
<p>An embeddable Object is a way to group properties of an <a href="#entity">entity</a> into a separate Java (child) object. Unlike with implement <a href="#relationships">relationships</a> the embeddable is not a separate entity and its properties are stored (embedded) in the same table together with the entity. This is helpful to structure and reuse groups of properties.</p>
</div>
<div class="paragraph">
<p>The following example shows an <code>Address</code> implemented as an embeddable class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Embeddable
public class AddressEmbeddable {

  private String street;
  private String number;
  private Integer zipCode;
  private String city;

  @Column(name="STREETNUMBER")
  public String getNumber() {
    return number;
  }

  public void setNumber(String number) {
    this.number = number;
  }

  ...  // other getter and setter methods, equals, hashCode
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see an embeddable is similar to an entity class, but with an <code>@Embeddable</code> annotation instead of the <code>@Entity</code> annotation and without primary key or modification counter.
An Embeddable does not exist on its own but in the context of an entity.
As a simplification Embeddables do not require a separate interface and <a href="guide-transferobject.asciidoc#ETO">ETO</a> as the <a href="guide-beanmapping.asciidoc">bean-mapper</a> will create a copy automatically when converting the owning entity to an ETO.
However, in this case the embeddable becomes part of your <code>api</code> module that therefore needs a dependency on the <code>JPA</code>.</p>
</div>
<div class="paragraph">
<p>In addition to that the methods <code>equals(Object)</code> and <code>hashCode()</code> need to be implemented as this is required by Hibernate (it is not required for entities because they can be unambiguously identified by their primary key). For some hints on how to implement the <code>hashCode()</code> method please have a look <a href="http://stackoverflow.com/questions/113511/hash-code-implementation">here</a>.</p>
</div>
<div class="paragraph">
<p>Using this <code>AddressEmbeddable</code> inside an entity class can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  private AddressEmbeddable address;

  @Embedded
  public AddressEmbeddable getAddress() {
    return this.address;
  }

  public void setAddress(AddressEmbeddable address) {
    this.address = address;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Embedded</code> annotation needs to be used for embedded attributes. Note that if in all columns of the embeddable (here <code>Address</code>) are <code>null</code>, then the embeddable object itself is also <code>null</code> inside the entity. This has to be considered to avoid NullPointerException&#8217;s. Further this causes some issues with primitive types in embeddable classes that can be avoided by only using object types instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="inheritance">7.4. Inheritance</h4>
<div class="paragraph">
<p>Just like normal java classes, <a href="#entity">entity</a> classes can inherit from others. The only difference is that you need to specify how to map a class hierarchy to database tables. Generic abstract super-classes for entities can simply be annotated with <code>@MappedSuperclass</code>.</p>
</div>
<div class="paragraph">
<p>For all other cases the JPA offers the annotation <code>@Inheritance</code> with the property <code>strategy</code> talking an <code>InheritanceType</code> that has the following options:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>SINGLE_TABLE</code>: This strategy uses a single table that contains all columns needed to store all entity-types of the entire inheritance hierarchy. If a column is not needed for an entity because of its type, there is a null value in this column. An additional column is introduced, which denotes the type of the entity (called <code>dtype</code>).</p>
</li>
<li>
<p><code>TABLE_PER_CLASS</code>: For each concrete entity class there is a table in the database that can store such an entity with all its attributes. An entity is only saved in the table corresponding to its most concrete type. To get all entities of a super type, joins are needed.</p>
</li>
<li>
<p><code>JOINED</code>: In this case there is a table for every entity class including abstract classes, which contains only the columns for the persistent properties of that particular class. Additionally there is a primary key column in every table. To get an entity of a class that is a subclass of another one, joins are needed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Each of the three approaches has its advantages and drawbacks, which are discussed in detail <a href="http://openjpa.apache.org/builds/1.0.4/apache-openjpa-1.0.4/docs/manual/jpa_overview_mapping_inher.html#jpa_overview_mapping_inher_tpc">here</a>. In most cases, the first one should be used, because it is usually the fastest way to do the mapping, as no joins are needed when retrieving, searching or persisting entities. Moreover it is rather simple and easy to understand.
One major disadvantage is that the first approach could lead to a table with a lot of null values, which might have a negative impact on the database size.</p>
</div>
<div class="paragraph">
<p>The inheritance strategy has to be annotated to the top-most entity of the class hierarchy (where <code>@MappedSuperclass</code> classes are not considered) like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
public abstract class MyParentEntity extends ApplicationPersistenceEntity implements MyParent {
  ...
}

@Entity
public class MyChildEntity extends MyParentEntity implements MyChild {
  ...
}

@Entity
public class MyOtherEntity extends MyParentEntity implements MyChild {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a best practice we advise you to avoid entity hierarchies at all where possible and otherwise to keep the hierarchy as small as possible. In order to just ensure reuse or establish a common API you can consider a shared interface, a <code>@MappedSuperclass</code> or an <code>@Embeddable</code> instead of an entity hierarchy.</p>
</div>
</div>
<div class="sect3">
<h4 id="repositories-and-daos">7.5. Repositories and DAOs</h4>
<div class="paragraph">
<p>For each entity a code unit is created that groups all database operations for that entity. We recommend to use <a href="guide-repository.asciidoc">spring-data repositories</a> for that as it is most efficient for developers. As an alternative there is still the classic approach using <a href="guide-dao.asciidoc">DAOs</a>.</p>
</div>
<div class="sect4">
<h5 id="concurrency-control">Concurrency Control</h5>
<div class="paragraph">
<p>The concurrency control defines the way concurrent access to the same data of a database is handled. When several users (or threads of application servers) concurrently access a database, anomalies may happen, e.g. a transaction is able to see changes from another transaction although that one did, not yet commit these changes. Most of these anomalies are automatically prevented by the database system, depending on the <a href="http://en.wikipedia.org/wiki/Isolation_(database_systems)"><em>isolation level</em></a> (property <code>hibernate.connection.isolation</code> in the <code>jpa.xml</code>, see <a href="http://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html">here</a>, or <code>quarkus.datasource.jdbc.transaction-isolation-level</code> in the <code>application.properties</code>).</p>
</div>
<div class="paragraph">
<p>Another anomaly is when two stakeholders concurrently access a record, do some changes and write them back to the database. The JPA addresses this with different locking strategies (see <a href="http://www.objectdb.com/java/jpa/persistence/lock">here</a>).</p>
</div>
<div class="paragraph">
<p>As a best practice we are using optimistic locking for regular end-user <a href="guide-service-layer.asciidoc">services</a> (OLTP) and pessimistic locking for <a href="guide-batch-layer.asciidoc">batches</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="optimistic-locking">Optimistic Locking</h5>
<div class="paragraph">
<p>The class <code>com.devonfw.module.jpa.persistence.api.AbstractPersistenceEntity</code> already provides optimistic locking via a <code>modificationCounter</code> with the <code>@Version</code> annotation. Therefore JPA takes care of optimistic locking for you. When entities are transferred to clients, modified and sent back for update you need to ensure the <code>modificationCounter</code> is part of the game. If you follow our guides about <a href="guide-transferobject.asciidoc">transfer-objects</a> and <a href="guide-service-layer.asciidoc">services</a> this will also work out of the box.
You only have to care about two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to deal with optimistic locking in <a href="#relationships">relationships</a>?<br>
Assume an entity <code>A</code> contains a collection of <code>B</code> entities. Should there be a locking conflict if one user modifies an instance of <code>A</code> while another user in parallel modifies an instance of <code>B</code> that is contained in the other instance? To address this , take a look at <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/feature/FeatureForceIncrementModificationCounter.java">FeatureForceIncrementModificationCounter</a>.</p>
</li>
<li>
<p>What should happen in the UI if an <code>OptimisticLockException</code> occurred?<br>
According to KISS our recommendation is that the user gets an error displayed that tells him to do his change again on the recent data. Try to design your system and the work processing in a way to keep such conflicts rare and you are fine.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="pessimistic-locking">Pessimistic Locking</h5>
<div class="paragraph">
<p>For back-end <a href="guide-service-layer.asciidoc">services</a> and especially for <a href="guide-batch-layer.asciidoc">batches</a> optimistic locking is not suitable. A human user shall not cause a large batch process to fail because he was editing the same entity. Therefore such use-cases use pessimistic locking what gives them a kind of priority over the human users.
In your <a href="#data-access-object">DAO</a> implementation you can provide methods that do pessimistic locking via <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html"><code>EntityManager</code></a> operations that take a <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html"><code>LockModeType</code></a>. Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  getEntityManager().lock(entity, LockModeType.READ);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>lock(Object, LockModeType)</code> method with <code>LockModeType.READ</code>, Hibernate will issue a <code>SELECT &#8230;&#8203; FOR UPDATE</code>. This means that no one else can update the entity (see <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_10002.htm">here</a> for more information on the statement). If <code>LockModeType.WRITE</code> is specified, Hibernate issues a <code>SELECT &#8230;&#8203; FOR UPDATE NOWAIT</code> instead, which has has the same meaning as the statement above, but if there is already a lock, the program will not wait for this lock to be released. Instead, an exception is raised.<br>
Use one of the types if you want to modify the entity later on, for read only access no lock is required.</p>
</div>
<div class="paragraph">
<p>As you might have noticed, the behavior of Hibernate deviates from what one would expect by looking at the <code>LockModeType</code> (especially <code>LockModeType.READ</code> should not cause a <code>SELECT &#8230;&#8203; FOR UPDATE</code> to be issued). The framework actually deviates from what is <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/LockModeType.html">specified</a> in the JPA for unknown reasons.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="database-auditing">7.6. Database Auditing</h4>
<div class="paragraph">
<p>See <a href="guide-auditing.asciidoc">auditing guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="testing-data-access">7.7. Testing Data-Access</h4>
<div class="paragraph">
<p>For testing of Entities and Repositories or DAOs see <a href="guide-testing.asciidoc#level-2-component-test">testing guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="principles">7.8. Principles</h4>
<div class="paragraph">
<p>We strongly recommend these principles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the JPA where ever possible and use vendor (hibernate) specific features only for situations when JPA does not provide a solution. In the latter case consider first if you really need the feature.</p>
</li>
<li>
<p>Create your entities as simple POJOs and use JPA to annotate the getters in order to define the mapping.</p>
</li>
<li>
<p>Keep your entities simple and avoid putting advanced logic into entity methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="database-configuration">7.9. Database Configuration</h4>
<div class="paragraph">
<p>For details on the configuration of the database connection and database logging of the individual framework, please refer to the respective configuration guide.</p>
</div>
<div class="paragraph">
<p>For <a href="spring.asciidoc">spring</a> see <a href="spring/guide-spring-configuration.asciidoc#database-configuration">here</a>.</p>
</div>
<div class="paragraph">
<p>For <a href="quarkus.asciidoc">quarkus</a> see <a href="quarkus/guide-quarkus-configuration.asciidoc#database-configuration">here</a>.</p>
</div>
<div class="sect4">
<h5 id="database-migration">Database Migration</h5>
<div class="paragraph">
<p>See <a href="guide-database-migration.asciidoc">database migration</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="pooling">Pooling</h5>
<div class="paragraph">
<p>You typically want to pool JDBC connections to boost performance by recycling previous connections. There are many libraries available to do connection pooling. We recommend to use <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a>. For Oracle RDBMS see <a href="guide-oracle.asciidoc#pooling">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="security-2">7.10. Security</h4>
<div class="sect4">
<h5 id="sql-injection">SQL-Injection</h5>
<div class="paragraph">
<p>A common <a href="guide-security.asciidoc">security</a> threat is <a href="http://en.wikipedia.org/wiki/SQL_injection">SQL-injection</a>. Never build queries with string concatenation or your code might be vulnerable as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  String query = "Select op from OrderPosition op where op.comment = " + userInput;
  return getEntityManager().createQuery(query).getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via the parameter <code>userInput</code> an attacker can inject SQL (JPQL) and execute arbitrary statements in the database causing extreme damage.</p>
</div>
<div class="paragraph">
<p>In order to prevent such injections you have to strictly follow our rules for <a href="#queries">queries</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use named queries for <a href="guide-jpa-query.asciidoc#static-queries">static queries</a>.</p>
</li>
<li>
<p>Use QueryDSL for <a href="guide-jpa-query.asciidoc#dynamic-queries">dynamic queries</a>.</p>
</li>
<li>
<p>Please also consult the <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet">SQL Injection Prevention Cheat Sheet</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="limited-permissions-for-application">Limited Permissions for Application</h5>
<div class="paragraph">
<p>We suggest that you operate your application with a database user that has limited permissions so he can not modify the SQL schema (e.g. drop tables). For initializing the schema (DDL) or to do schema migrations use a separate user that is not used by the application itself.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="queries">7.11. Queries</h4>
<div class="paragraph">
<p>The <a href="http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html">Java Persistence API (JPA)</a> defines its own query language, the <a href="https://docs.oracle.com/html/E13946_01/ejb3_langref.html"><em>java persistence query language</em> (JPQL)</a> (see also <a href="https://docs.oracle.com/javaee/7/tutorial/persistence-querylanguage.htm">JPQL tutorial</a>), which is similar to SQL but operates on entities and their attributes instead of tables and columns.</p>
</div>
<div class="paragraph">
<p>The simplest CRUD-Queries (e.g. find an entity by its ID) are already build in the devonfw CRUD functionality (via <a href="guide-repository.asciidoc">Repository</a> or <a href="guide-dao.asciidoc">DAO</a>). For other cases you need to write your own query. We distinguish between <em>static</em> and <em>dynamic</em> queries. <a href="#static-queries">Static queries</a> have a fixed JPQL query string that may only use parameters to customize the query at runtime. Instead, <a href="#dynamic-queries">dynamic queries</a> can change their clauses (<code>WHERE</code>, <code>ORDER BY</code>, <code>JOIN</code>, etc.) at runtime depending on the given search criteria.</p>
</div>
<div class="sect4">
<h5 id="static-queries">Static Queries</h5>
<div class="paragraph">
<p>E.g. to find all <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/DishEntity.java">DishEntries</a> (from MTS sample app) that have a price not exceeding a given <code>maxPrice</code> we write the following JPQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT dish FROM DishEntity dish WHERE dish.price &lt;= :maxPrice</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>dish</code> is used as alias (variable name) for our selected <code>DishEntity</code> (what refers to the simple name of the Java entity class). With <code>dish.price</code> we are referring to the Java property <code>price</code> (<code>getPrice()</code>/<code>setPrice(&#8230;&#8203;)</code>) in <code>DishEntity</code>. A named variable provided from outside (the search criteria at runtime) is specified with a colon (<code>:</code>) as prefix. Here with <code>:maxPrice</code> we reference to a variable that needs to be set via <code>query.setParameter("maxPrice", maxPriceValue)</code>. JPQL also supports indexed parameters (<code>?</code>) but they are discouraged because they easily cause confusion and mistakes.</p>
</div>
<div class="sect5">
<h6 id="using-queries-to-avoid-bidirectional-relationships">Using Queries to Avoid Bidirectional Relationships</h6>
<div class="paragraph">
<p>With the usage of queries it is possible to avoid exposing relationships or modelling bidirectional relationships, which have some disadvantages (see <a href="guide-jpa.asciidoc#relationships">relationships</a>). This is especially desired for relationships between entities of different business components.
So for example to get all <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/ordermanagement/dataaccess/api/OrderLineEntity.java">OrderLineEntities</a> for a specific <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/ordermanagement/dataaccess/api/OrderEntity.java">OrderEntity</a> without using the <code>orderLines</code> relation from <code>OrderEntity</code> the following query could be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT line FROM OrderLineEntity line WHERE line.order.id = :orderId</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dynamic-queries">Dynamic Queries</h5>
<div class="paragraph">
<p>For dynamic queries, we use the <a href="http://querydsl.com/static/querydsl/latest/reference/html/ch02.html">JPA</a> module for <a href="http://www.querydsl.com/">Querydsl</a>. Querydsl also supports other modules such as <a href="http://querydsl.com/static/querydsl/latest/reference/html/ch02s07.html">MongoDB</a>, and <a href="http://querydsl.com/static/querydsl/latest/reference/html/ch02s05.html">Apache Lucene</a>. It allows to implement queries in a powerful but readable and type-safe way (unlike Criteria API). If you already know JPQL, you will quickly be able to read and write Querydsl code. It feels like JPQL but implemented in Java instead of plain text.</p>
</div>
<div class="paragraph">
<p>To use Querydsl in your Maven project, add the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependencies&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
        &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt;
        &lt;version&gt;${querydsl.version}&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
        &lt;artifactId&gt;querydsl-jpa&lt;/artifactId&gt;
        &lt;version&gt;${querydsl.version}&lt;/version&gt;
    &lt;/dependency&gt;

&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, configure the annotation processing tool (APT) plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      ...
      &lt;plugin&gt;
        &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt;
        &lt;artifactId&gt;apt-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.1.3&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;process&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;outputDirectory&gt;target/generated-sources/java&lt;/outputDirectory&gt;
              &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      ...
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example from our sample application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  public List&lt;DishEntity&gt; findDishes(DishSearchCriteriaTo criteria) {
    QDishEntity dish = QDishEntity.dishEntity;
    JPAQuery&lt;DishEntity&gt; query = new JPAQuery&lt;OrderEntity&gt;(getEntityManager());
    query.from(dish);

    Range&lt;BigDecimal&gt; priceRange = criteria.getPriceRange();
    if (priceRange != null) {
      BigDecimal min = priceRange.getMin();
      if (min != null) {
        query.where(dish.price.goe(min));
      }
      BigDecimal max = priceRange.getMax();
      if (max != null) {
        query.where(dish.price.loe(max));
      }
    }
    String name = criteria.getName();
    if ((name != null) &amp;&amp; (!name.isEmpty())) {
      query.where(dish.name.eq(name));
    }
    query.orderBy(dish.price.asc(), dish.name.asc());
    return query.fetch();
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we use the so called Q-types (<code>QDishEntity</code>). These are classes generated at build time by the Querydsl annotation processor from entity classes. The Q-type classes can be used as static types representative of the original entity class.</p>
</div>
<div class="paragraph">
<p>The <code>query.from(dish)</code> method call defines the query source, in this case the <code>dish</code> table. The <code>where</code> method defines a filter. For example, The first call uses the <code>goe</code> operator to filter out any dishes that are not greater or equal to the minimal price. Further operators can be found <a href="https://querydsl.com/static/querydsl/latest/apidocs/com/querydsl/core/types/dsl/ComparableExpression.html">here</a>.</p>
</div>
<div class="paragraph">
<p>The <code>orderBy</code> method is used to sort the query results according to certain criteria. Here, we sort the results first by their price and then by their name, both in ascending order. To sort in descending order, use <code>.desc()</code>. To partition query results into groups of rows, see the <a href="https://querydsl.com/static/querydsl/latest/reference/html_single/#d0e377">groupBy</a> method.</p>
</div>
<div class="paragraph">
<p>For spring, devon4j provides another approach that you can use for your Spring applications to implement Querydsl logic without having to use these metaclasses. An example can be found <a href="spring/guide-querydsl-spring.asciidoc">here</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="native-queries">Native Queries</h5>
<div class="paragraph">
<p>Spring Data supports the use of <em>native queries</em>. Native queries use simple native SQL syntax that is not parsed in JPQL. This allows you to use all the features that your database supports.
The downside to this is that database portability is lost due to the absence of an abstraction layer. Therefore, the queries may not work with another database because it may use a different syntax.</p>
</div>
<div class="paragraph">
<p>You can implement a native query using <code>@Query</code> annotation with the <code>nativeQuery</code> attribute set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Query(value="...", nativeQuery=true)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This will not work with Quarkus because Quarkus does not support native queries by using the <code>@Query</code> annotation (see <a href="guide-repository.asciidoc#limitations-in-quarkus">here</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also implement native queries directly using the <code>EntityManager</code> API and the <code>createNativeQuery</code> method.
<strong>This approach also works with Quarkus</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Query query = entityManager.createNativeQuery("SELECT * FROM Product", ProductEntity.class);
List&lt;ProductEntity&gt; products = query.getResultList();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be sure to use the name of the table when using native queries, while you must use the entity name when implementing queries with JPQL.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using-wildcards">Using Wildcards</h5>
<div class="paragraph">
<p>For flexible queries it is often required to allow wildcards (especially in <a href="#dynamic_queries">dynamic queries</a>). While users intuitively expect glob syntax, the SQL and JPQL standards work differently. Therefore, a mapping is required. devonfw provides this on a lower level with <a href="https://github.com/devonfw/devon4j/blob/develop/modules/basic/src/main/java/com/devonfw/module/basic/common/api/query/LikePatternSyntax.java">LikePatternSyntax</a> and on a higher level with <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryUtil.java#L54">QueryUtil</a> (see <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryHelper.java#L199">QueryHelper.newStringClause(&#8230;&#8203;)</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="pagination">Pagination</h5>
<div class="paragraph">
<p>When dealing with large amounts of data, an efficient method of retrieving the data is required. Fetching the entire data set each time would be too time consuming. Instead, <em>Paging</em> is used to process only small subsets of the entire data set.</p>
</div>
<div class="paragraph">
<p>If you are using <a href="guide-repository.asciidoc">Spring Data repositories</a> you will get pagination support out of the box by providing the interfaces <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Page</a> and  <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Pageable.html">Pageable</a>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. <strong>repository</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Page&lt;DishEntity&gt; findAll(Pageable pageable);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can create a Pageable object and pass it to the method call as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">int page = criteria.getPageNumber();
int size = criteria.getPageSize();
Pageable pageable = PageRequest.of(page, size);
Page&lt;DishEntity&gt; dishes = dishRepository.findAll(pageable);</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="paging-with-querydsl">Paging with Querydsl</h6>
<div class="paragraph">
<p>Pagination is also supported for dynamic queries with Querydsl:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  public Page&lt;DishEntity&gt; findDishes(DishSearchCriteriaTo criteria) {
    QDishEntity dish = QDishEntity.dishEntity;
    JPAQuery&lt;DishEntity&gt; query = new JPAQuery&lt;OrderEntity&gt;(getEntityManager());
    query.from(dish);

    // conditions

    int page = criteria.getPageNumber();
    int size = criteria.getPageSize();
    Pageable pageable = PageRequest.of(page, size);
    query.offset(pageable.getOffset());
    query.limit(pageable.getPageSize());

    List&lt;DishEntity&gt; dishes = query.fetch();
    return new PageImpl&lt;&gt;(dishes, pageable, dishes.size());
  }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="pagination-example">Pagination example</h6>
<div class="paragraph">
<p>For the table entity we can make a search request by accessing the REST endpoint with pagination support like in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">POST mythaistar/services/rest/tablemanagement/v1/table/search
{
  "pagination": {
    "size":2,
    "total":true
  }
}

//Response
{
    "pagination": {
        "size": 2,
        "page": 1,
        "total": 11
    },
    "result": [
        {
            "id": 101,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 1,
            "state": "OCCUPIED"
        },
        {
            "id": 102,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 2,
            "state": "FREE"
        }
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As we are requesting with the <code>total</code> property set to <code>true</code> the server responds with the total count of rows for the query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For retrieving a concrete page, we provide the <code>page</code> attribute with the desired value. Here we also left out the <code>total</code> property so the server doesn&#8217;t incur on the effort to calculate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">POST mythaistar/services/rest/tablemanagement/v1/table/search
{
  "pagination": {
    "size":2,
    "page":2
  }
}

//Response

{
    "pagination": {
        "size": 2,
        "page": 2,
        "total": null
    },
    "result": [
        {
            "id": 103,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 3,
            "state": "FREE"
        },
        {
            "id": 104,
            "modificationCounter": 1,
            "revision": null,
            "waiterId": null,
            "number": 4,
            "state": "FREE"
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="pagingation-in-devon4j-spring">Pagingation in devon4j-spring</h6>
<div class="paragraph">
<p>For spring applications, devon4j also offers its own solution for pagination. You can find an example of this <a href="spring/guide-querydsl-spring.asciidoc#pagination">here</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query-meta-parameters">Query Meta-Parameters</h5>
<div class="paragraph">
<p>Queries can have meta-parameters and that are provided via <code>SearchCriteriaTo</code>. Besides paging (see above) we also get <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryHelper.java#L51">timeout support</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="advanced-queries">Advanced Queries</h5>
<div class="paragraph">
<p>Writing queries can sometimes get rather complex. The current examples given above only showed very simple basics. Within this topic a lot of advanced features need to be considered like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.w3schools.com/sql/sql_join.asp">Joins</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/html/E13946_04/ejb3_langref.html#ejb3_langref_constructor">Constructor queries</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_orderby.asp">Order By</a> (Sorting)</p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_groupby.asp">Grouping</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_having.asp">Having</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_union.asp">Unions</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/cd/E11035_01/kodo41/full/html/ejb3_langref.html#ejb3_langref_subqueries">Sub-Queries</a></p>
</li>
<li>
<p>Aggregation functions like e.g. <a href="https://www.w3schools.com/sql/sql_count_avg_sum.asp">count/avg/sum</a></p>
</li>
<li>
<p><a href="https://www.w3schools.com/sql/sql_distinct.asp">Distinct selections</a></p>
</li>
<li>
<p>SQL Hints (see e.g. <a href="https://docs.oracle.com/cd/B19306_01/server.102/b14211/hintsref.htm#i8327">Oracle hints</a> or <a href="http://sqlhints.com/">SQL-Server hints</a>) - only when required for ultimate performance tuning</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This list is just containing the most important aspects. As we can not cover all these topics here, they are linked to external documentation that can help and guide you.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="spring-data">7.12. Spring Data</h4>
<div class="paragraph">
<p><a href="https://projects.spring.io/spring-data-jpa/">Spring Data JPA</a> is supported by both Spring and Quarkus. However, in Quarkus this approach still has some limitations. For detailed information, see the official <a href="https://quarkus.io/guides/spring-data-jpa">Quarkus Spring Data guide</a>.</p>
</div>
<div class="sect4">
<h5 id="motivation">Motivation</h5>
<div class="paragraph">
<p>The benefits of Spring Data are (for examples and explanations see next sections):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All you need is one single repository interface for each entity. No need for a separate implementation or other code artifacts like XML descriptors, <code>NamedQueries</code> class, etc.</p>
</li>
<li>
<p>You have all information together in one place (the repository interface) that actually belong together (where as in the classic approach you have the static <a href="guide-jpa-query.asciidoc">queries</a> in an XML file, constants to them in <code>NamedQueries</code> class and referencing usages in DAO implementation classes).</p>
</li>
<li>
<p>Static <a href="guide-jpa-query.asciidoc">queries</a> are most simple to realize as you do not need to write any method body. This means you can develop faster.</p>
</li>
<li>
<p>Support for paging is already build-in. Again for static <a href="guide-jpa-query.asciidoc">query</a> method the is nothing you have to do except using the paging objects in the signature.</p>
</li>
<li>
<p>Still you have the freedom to write custom implementations via default methods within the repository interface (e.g. for dynamic queries).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dependency">Dependency</h5>
<div class="paragraph">
<p>In case you want to switch to or add Spring Data support to your Spring or Quarkus application, all you need is to add the respective maven dependency:</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. <strong>spring</strong></div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 3. <strong>quarkus</strong></div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-spring-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="repository">Repository</h5>
<div class="paragraph">
<p>For each entity <code>«Entity»Entity</code> an interface is created with the name <code>«Entity»Repository</code> extending <a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html">JpaRepository</a>.
Such repository is the analogy to a <a href="guide-dao.asciidoc">Data-Access-Object (DAO)</a> used in the classic approach or when Spring Data is not an option.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. <strong>Repository</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ProductRepository extends JpaRepository&lt;ProductEntity, Long&gt; {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Data repository provides some basic implementations for accessing data, e.g. returning all instances of a type (<code>findAll</code>) or returning an instance by its ID (<code>findById</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="custom-method-implementation">Custom method implementation</h5>
<div class="paragraph">
<p>In addition, repositories can be enriched with additional functionality, e.g. to add QueryDSL functionality or to override the default implementations, by using so called repository fragments:</p>
</div>
<div class="sect5">
<h6 id="example">Example</h6>
<div class="paragraph">
<p>The following example shows how to write such a repository:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. <strong>Repository</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ProductRepository extends JpaRepository&lt;ProductEntity, Long&gt;, ProductFragment {

  @Query("SELECT product FROM ProductEntity product" //
      + " WHERE product.title = :title")
  List&lt;ProductEntity&gt; findByTitle(@Param("title") String title);

  @Query("SELECT product FROM ProductEntity product" //
      + " WHERE product.title = :title")
  Page&lt;ProductEntity&gt; findByTitlePaginated(@Param("title") String title, Pageable pageable);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 6. <strong>Repository fragment</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ProductFragment {
  Page&lt;ProductEntity&gt; findByCriteria(ProductSearchCriteriaTo criteria);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 7. <strong>Fragment implementation</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ProductFragmentImpl implements ProductFragment {
  @Inject
  EntityManager entityManager;

  public Page&lt;ProductEntity&gt; findByCriteria(ProductSearchCriteriaTo criteria) {
    QProductEntity product = QProductEntity.productEntity;
    JPAQuery&lt;ProductEntity&gt; query = new JPAQuery&lt;ProductEntity&gt;(this.entityManager);
    query.from(product);

    String title = criteria.getTitle();
    if ((title != null) &amp;&amp; !title.isEmpty()) {
      query.where(product.title.eq(title));
    }

    List&lt;ProductEntity&gt; products = query.fetch();
    return new PageImpl&lt;&gt;(products, PageRequest.of(criteria.getPageNumber(), criteria.getPageSize()), products.size());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>ProductRepository</code> has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CRUD support from Spring Data (see <a href="https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html">JavaDoc</a> for details).</p>
</li>
<li>
<p>Support for <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/api/data/QueryDslSupport.java">QueryDSL integration</a>, <a href="https://github.com/devonfw/devon4j/blob/develop/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/QueryUtil.java">paging and more</a>.</p>
</li>
<li>
<p>A static <a href="guide-jpa-query.asciidoc">query</a> method <code>findByTitle</code> to find all <code>ProductEntity</code> instances from DB that have the given title. Please note the <code>@Param</code> annotation that links the method parameter with the variable inside the query (<code>:title</code>).</p>
</li>
<li>
<p>The same with pagination support via findByTitlePaginated method.</p>
</li>
<li>
<p>A dynamic <a href="guide-jpa-query.asciidoc">query</a> method <code>findByCriteria</code> showing the QueryDSL and paging integration into Spring via a fragment implementation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find an implementation of this <code>ProductRepository</code> in our <a href="https://github.com/devonfw-sample/devon4quarkus-reference/tree/master/src/main/java/com/devonfw/quarkus/productmanagement/domain/repo">Quarkus reference application</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In Quarkus, native and named queries via the <code>@Query</code> annotation are currently not supported
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="integration-of-spring-data-in-devon4j-spring">Integration of Spring Data in devon4j-spring</h6>
<div class="paragraph">
<p>For Spring applications, devon4j offers a proprietary solution that integrates seamlessly with QueryDSL and uses default methods instead of the fragment approach. A separate guide for this can be found <a href="spring/guide-devon4j-spring-repository.asciidoc">here</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="custom-methods-without-fragment-approach">Custom methods without fragment approach</h6>
<div class="paragraph">
<p>The fragment approach is a bit laborious, as three types (repository interface, fragment interface and fragment implementation) are always needed to implement custom methods.
We cannot simply use default methods within the repository because we cannot inject the <code>EntityManager</code> directly into the repository interface.</p>
</div>
<div class="paragraph">
<p>As a workaround, you can create a <code>GenericRepository</code> interface, as is done in the <a href="https://github.com/devonfw/devon4j/tree/master/modules/jpa-spring-data/src/main/java/com/devonfw/module/jpa/dataaccess/impl/data">devon4j jpa-spring-data module</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface GenericRepository&lt;E&gt; {

  EntityManager getEntityManager();

  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class GenericRepositoryImpl&lt;E&gt; implements GenericRepository&lt;E&gt; {

  @Inject
  EntityManager entityManager;

  @Override
  public EntityManager getEntityManager() {

    return this.entityManager;
  }

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, all your repository interfaces can extend the <code>GenericRepository</code> and you can implement queries directly in the repository interface using default methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface ProductRepository extends JpaRepository&lt;ProductEntity, Long&gt;, GenericRepository&lt;ProductEntity&gt; {

  default Page&lt;ProductEntity&gt; findByTitle(Title title) {

    EntityManager entityManager = getEntityManager();
    Query query = entityManager.createNativeQuery("select * from Product where title = :title", ProductEntity.class);
    query.setParameter("title", title);
    List&lt;ProductEntity&gt; products = query.getResultList();
    return new PageImpl&lt;&gt;(products);
  }

  ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drawbacks">Drawbacks</h5>
<div class="paragraph">
<p>Spring Data also has some drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some kind of magic behind the scenes that are not so easy to understand. So in case you want to extend all your repositories without providing the implementation via a default method in a parent repository interface you need to deep-dive into Spring Data. We assume that you do not need that and hope what Spring Data and devon already provides out-of-the-box is already sufficient.</p>
</li>
<li>
<p>The Spring Data magic also includes guessing the query from the method name. This is not easy to understand and especially to debug. Our suggestion is not to use this feature at all and either provide a <code>@Query</code> annotation or an implementation via default method.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="limitations-in-quarkus">Limitations in Quarkus</h5>
<div class="ulist">
<ul>
<li>
<p>Native and named queries are not supported using <code>@Query</code> annotation. You will receive something like: <em>Build step io.quarkus.spring.data.deployment.SpringDataJPAProcessor#build threw an exception: java.lang.IllegalArgumentException: Attribute nativeQuery of @Query is currently not supported</em></p>
</li>
<li>
<p>Customizing the base repository for all repository interfaces in the code base, which is done in Spring Data by registering a class the extends <code>SimpleJpaRepository</code></p>
</li>
</ul>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="data-access-object">7.13. Data Access Object</h4>
<div class="paragraph">
<p>The <em>Data Access Objects</em> (DAOs) are part of the persistence layer.
They are responsible for a specific <a href="#entity">entity</a> and should be named <code>«Entity»Dao</code> and <code>«Entity»DaoImpl</code>.
The DAO offers the so called CRUD-functionalities (create, retrieve, update, delete) for the corresponding entity.
Additionally a DAO may offer advanced operations such as <a href="guide-jpa-query.asciidoc">query</a> or locking methods.</p>
</div>
<div class="sect4">
<h5 id="dao-interface">DAO Interface</h5>
<div class="paragraph">
<p>For each DAO there is an interface named <code>«Entity»Dao</code> that defines the API. For CRUD support and common naming we derive it from the <code>ApplicationDao</code> interface that comes with the devon application template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface MyEntityDao extends ApplicationDao&lt;MyEntity&gt; {
  List&lt;MyEntity&gt; findByCriteria(MyEntitySearchCriteria criteria);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All CRUD operations are inherited from <code>ApplicationDao</code> so you only have to declare the additional methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="dao-implementation">DAO Implementation</h5>
<div class="paragraph">
<p>Implementing a DAO is quite simple. We create a class named <code>«Entity»DaoImpl</code> that extends <code>ApplicationDaoImpl</code> and implements your <code>«Entity»Dao</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyEntityDaoImpl extends ApplicationDaoImpl&lt;MyEntity&gt; implements MyEntityDao {

  public List&lt;MyEntity&gt; findByCriteria(MyEntitySearchCriteria criteria) {
    TypedQuery&lt;MyEntity&gt; query = createQuery(criteria, getEntityManager());
    return query.getResultList();
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again you only need to implement the additional non-CRUD methods that you have declared in your <code>«Entity»Dao</code> interface.
In the DAO implementation you can use the method <code>getEntityManager()</code> to access the <code>EntityManager</code> from the JPA. You will need the <code>EntityManager</code> to create and execute <a href="guide-jpa-query.asciidoc">queries</a>.</p>
</div>
<div class="sect5">
<h6 id="static-queries-for-dao-implementation">Static queries for DAO Implementation</h6>
<div class="paragraph">
<p>All static <a href="guide-jpa-query.asciidoc">queries</a> are declared in the file <code>src\main\resources\META-INF\orm.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entity-mappings version="1.0" xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"&gt;
  &lt;named-query name="find.dish.with.max.price"&gt;
    &lt;query&gt;&lt;![SELECT dish FROM DishEntity dish WHERE dish.price &lt;= :maxPrice]]&gt;&lt;/query&gt;
  &lt;/named-query&gt;
  ...
&lt;/hibernate-mapping&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When your application is started, all these static queries will be created as prepared statements. This allows better performance and also ensures that you get errors for invalid JPQL queries when you start your app rather than later when the query is used.</p>
</div>
<div class="paragraph">
<p>To avoid redundant occurrences of the query name (<code>get.open.order.positions.for.order</code>) we define a constant for each named query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class NamedQueries {
  public static final String FIND_DISH_WITH_MAX_PRICE = "find.dish.with.max.price";
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that changing the name of the java constant (<code>FIND_DISH_WITH_MAX_PRICE</code>) can be done easily with refactoring. Further you can trace where the query is used by searching the references of the constant.</p>
</div>
<div class="paragraph">
<p>The following listing shows how to use this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public List&lt;DishEntity&gt; findDishByMaxPrice(BigDecimal maxPrice) {
  Query query = getEntityManager().createNamedQuery(NamedQueries.FIND_DISH_WITH_MAX_PRICE);
  query.setParameter("maxPrice", maxPrice);
  return query.getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via <code>EntityManager.createNamedQuery(String)</code> we create an instance of <code>Query</code> for our predefined static query.
Next we use <code>setParameter(String, Object)</code> to provide a parameter (<code>maxPrice</code>) to the query. This has to be done for all parameters of the query.</p>
</div>
<div class="paragraph">
<p>Note that using the <code>createQuery(String)</code> method, which takes the entire query as string (that may already contain the parameter) is not allowed to avoid SQL injection vulnerabilities.
When the method <code>getResultList()</code> is invoked, the query is executed and the result is delivered as <code>List</code>. As an alternative, there is a method called <code>getSingleResult()</code>, which returns the entity if the query returned exactly one and throws an exception otherwise.</p>
</div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="jpa-performance">7.14. JPA Performance</h4>
<div class="paragraph">
<p>When using JPA the developer sometimes does not see or understand where and when statements to the database are triggered.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Establishing expectations Developers shouldn’t expect to sprinkle magic pixie dust on POJOs in hopes they will become persistent.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Dan Allen<br>
<cite>https://epdf.tips/seam-in-action.html</cite>
</div>
</div>
<div class="paragraph">
<p>So in case you do not understand what is going on under the hood of JPA, you will easily run into performance issues due to lazy loading and other effects.</p>
</div>
<div class="sect4">
<h5 id="n-plus-1-problem">N plus 1 Problem</h5>
<div class="paragraph">
<p>The most prominent phenomena is call the <code>N+1 Problem</code>.
We use entities from our <a href="https://github.com/devonfw/my-thai-star">MTS</a> demo app as an example to explain the problem.
There is a <a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/DishEntity.java">DishEntity</a> that has a <code>@ManyToMany</code> relation to
<a href="https://github.com/devonfw/my-thai-star/blob/develop/java/mtsj/core/src/main/java/com/devonfw/application/mtsj/dishmanagement/dataaccess/api/IngredientEntity.java">IngredientEntity</a>.
Now we assume that we want to iterate all ingredients for a dish like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">DishEntity dish = dao.findDishById(dishId);
BigDecimal priceWithAllExtras = dish.getPrice();
for (IngredientEntity ingredient : dish.getExtras()) {
  priceWithAllExtras = priceWithAllExtras.add(ingredient.getPrice());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>dish.getExtras()</code> is loaded lazy. Therefore the JPA vendor will provide a list with lazy initialized instances of <code>IngredientEntity</code> that only contain the ID of that entity. Now with every call of <code>ingredient.getPrice()</code> we technically trigger an SQL query statement to load the specific <code>IngredientEntity</code> by its ID from the database.
Now <code>findDishById</code> caused 1 initial query statement and for any number <code>N</code> of ingredients we are causing an additional query statement. This makes a total of <code>N+1</code> statements. As causing statements to the database is an expensive operation with a lot of overhead (creating connection, etc.) this ends in bad performance and is therefore a problem (the N+1 Problem).</p>
</div>
</div>
<div class="sect4">
<h5 id="solving-n-plus-1-problem">Solving N plus 1 Problem</h5>
<div class="paragraph">
<p>To solve the N+1 Problem you need to change your code to only trigger a single statement instead. This can be archived in various ways. The most universal solution is to use <code>FETCH JOIN</code> in order to pre-load the nested <code>N</code> child entities into the first level cache of the JPA vendor implementation. This will behave very similar as if the <code>@ManyToMany</code> relation to <code>IngredientEntity</code> was having <code>FetchType.EAGER</code> but only for the specific query and not in general. Because changing <code>@ManyToMany</code> to <code>FetchType.EAGER</code> would cause bad performance for other usecases where only the dish but not its extra ingredients are needed. For this reason all relations, including <code>@OneToOne</code> should always be <code>FetchType.LAZY</code>. Back to our example we simply replace <code>dao.findDishById(dishId)</code> with <code>dao.findDishWithExtrasById(dishId)</code> that we implement by the following JPQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">SELECT dish FROM DishEntity dish
  LEFT JOIN FETCH dish.extras
  WHERE dish.id = :dishId</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rest of the code does not have to be changed but now <code>dish.getExtras()</code> will get the <code>IngredientEntity</code> from the first level cache where is was fetched by the initial query above.</p>
</div>
<div class="paragraph">
<p>Please note that if you only need the sum of the prices from the extras you can also create a query using an aggregator function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT sum(dish.extras.price) FROM DishEntity dish</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you need to understand the concepts in order to get good performance.</p>
</div>
<div class="paragraph">
<p>There are many advanced topics such as creating database indexes or calculating statistics for the query optimizer to get the best performance. For such advanced topics we recommend to have a database expert in your team that cares about such things. However, understanding the <em>N+1 Problem</em> and its solutions is something that every Java developer in the team needs to understand.</p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect3">
<h4 id="idref">7.15. IdRef</h4>
<div class="paragraph">
<p>IdRef can be used to reference other entities in TOs in order to make them type-safe and semantically more expressive.
It is an optional concept in devon4j for more complex applications that make intensive use of relations and foreign keys.</p>
</div>
<div class="sect4">
<h5 id="motivation-2">Motivation</h5>
<div class="paragraph">
<p>Assuming you have a method signature like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Long approve(Long cId, Long cuId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>So what are the paremeters? What is returned?</p>
</div>
<div class="paragraph">
<p><code>IdRef</code> is just a wrapper for a Long used as foreign key. This makes our signature much more expressive and self-explanatory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">IdRef&lt;Contract&gt; approve(IdRef&lt;Contract&gt; cId, IdRef&lt;Customer&gt; cuId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can easily see, that the result and the parameters are foreign-keys and which entity they are referring to via their generic type.
We can read the javadoc of these entities from the generic type and understand the context.
Finally, when passing <code>IdRef</code> objects to such methods, we get compile errors in case we accidentally place parameters in the wrong order.</p>
</div>
</div>
<div class="sect4">
<h5 id="idref-and-mapping">IdRef and Mapping</h5>
<div class="paragraph">
<p>In order to easily map relations from entities to <a href="guide-transferobject.asciidoc">transfer-objects</a> and back, we can easily also put according getters and setters into our entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ContractEntity extends ApplicationPersistenceEntity implements Contract {

  private CustomerEntity customer;

  ...

  @ManyToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "CUSTOMER_ID")
  public CustomerEntity getCustomer() {
    return this.customer;
  }

  public void setCustomer(CustomerEntity customer) {
    this.customer = customer;
  }

  @Transient
  public IdRef&lt;Customer&gt; getCustomerId() {
    return IdRef.of(this.customer);
  }

  public void setCustomerId(IdRef&lt;Customer&gt; customerId) {
    this.customer = JpaHelper.asEntity(customerId, CustomerEntity.class);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, ensure that you have the same getters and setters for <code>customerId</code> in your <code>Eto</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ContractEto extends AbstractEto implements Contract {

  private IdRef&lt;Customer&gt; customerId;

  ...

  public IdRef&lt;Customer&gt; getCustomerId() {
    return this.customerId;
  }

  public void setCustomerId(IdRef&lt;Customer&gt; customerId) {
    this.customerId = customerId;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way the bean-mapper can automatically map from your entity (<code>ContractEntity</code>) to your Eto (<code>ContractEto</code>) and vice-versa.</p>
</div>
</div>
<div class="sect4">
<h5 id="jpahelper-and-entitymanager-access">JpaHelper and EntityManager access</h5>
<div class="paragraph">
<p>In the above example we used <code>JpaHelper.asEntity</code> to convert the foreign key (<code>IdRef&lt;Customer&gt;</code>) to the according entity (<code>CustomerEntity</code>).
This will internally use <code>EntityManager.getReference</code> to properly create a JPA entity.
The alternative "solution" that may be used with <code>Long</code> instead of <code>IdRef</code> is typically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  public void setCustomerId(IdRef&lt;Customer&gt; customerId) {
    Long id = null;
    if (customerId != null) {
      id = customerId.getId();
    }
    if (id == null) {
      this.customer = null;
    } else {
      this.customer = new CustomerEntity();
      this.customer.setId(id);
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this "solution" works is most cases, we discovered some more complex cases, where it fails with very strange hibernate exceptions.
When cleanly creating the entity via <code>EntityManager.getReference</code> instead it is working in all cases.
So how can <code>JpaHelper.asEntity</code> as a static method access the <code>EntityManager</code>?
Therefore we need to initialize this as otherwise you may see this exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.lang.IllegalStateException: EntityManager has not yet been initialized!
	at com.devonfw.module.jpa.dataaccess.api.JpaEntityManagerAccess.getEntityManager(JpaEntityManagerAccess.java:38)
	at com.devonfw.module.jpa.dataaccess.api.JpaHelper.asEntity(JpaHelper.java:49)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For main usage in your application we assume that there is only one instance of <code>EntityManager</code>.
Therefore we can initialize this instance during the spring boot setup.
This is what we provide for you in <a href="https://github.com/devonfw/devon4j/blob/master/modules/jpa-basic/src/main/java/com/devonfw/module/jpa/dataaccess/api/JpaInitializer.java">JpaInitializer</a> for you
when <a href="tutorial-newapp.asciidoc">creating a devon4j app</a>.</p>
</div>
<div class="sect5">
<h6 id="jpahelper-and-spring-test">JpaHelper and spring-test</h6>
<div class="paragraph">
<p>Further, you also want your code to work in integration tests.
Spring-test provides a lot of magic under the hood to make integration testing easy for you.
To boost the performance when running multiple tests, spring is smart and avoids creating the same spring-context multiple times.
Therefore it stores these contexts so that if a test-case is executed with a specific spring-configuration that has already been setup before,
the same spring-context can be reused instead of creating it again.
However, your tests may have multiple spring configurations leading to multiple spring-contexts.
Even worse these tests can run in any order leading to switching between spring-contexts forth and back.
Therefore, a static initializer during the spring boot setup can lead to strange errors as you can get the wrong <code>EntityManager</code> instance.
In order to fix such problems, we provide a solution pattern via <a href="https://github.com/devonfw/devon4j/blob/master/modules/test-jpa/src/main/java/com/devonfw/module/test/common/base/DbTest.java#L32">DbTest</a> ensuring for every test,
that the proper instance of <code>EntityManager</code> is initialized.
Therefore you should derive directly or indirectly (e.g. via <code>ComponentDbTest</code> and <code>SubsystemDbTest</code>) from <code>DbTesT</code> or adopt your own way to apply this pattern to your tests, when using <code>JpaHelper</code>.
This already happens if you are extending <code>ApplicationComponentTest</code> or <code>ApplicationSubsystemTest</code>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="sect3">
<h4 id="transaction-handling">7.16. Transaction Handling</h4>
<div class="paragraph">
<p>For transaction handling we <a href="guide-aop.asciidoc">AOP</a> to add transaction control via annotations as aspect.
This is done by annotating your code with the <code>@Transactional</code> annotation.
You can either annotate your <a href="guide-dependency-injection.asciidoc#key-principles">container bean</a> at class level to make all methods transactional or your can annotate individual methods to make them transactional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">  @Transactional
  public Output getData(Input input) {
    ...
  }</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="jta-imports">JTA Imports</h5>
<div class="paragraph">
<p>Here are the import statements for transaction support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.transaction.Transactional;</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Use the above import statement to follow JEE and avoid using <code>org.springframework.transaction.annotation.Transactional</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jta-dependencies">JTA Dependencies</h5>
<div class="paragraph">
<p>Please note that with <a href="https://jakarta.ee/">Jakarta EE</a> the dependencies have changed.
When you want to start with Jakarta EE you should use these dependencies to get the annoations for dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Java Transaction API (JTA) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;jakarta.transaction&lt;/groupId&gt;
  &lt;artifactId&gt;jakarta.transaction-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that with <a href="quarkus.asciidoc">quarkus</a> you will get them as transitive dependencies out of the box.
The above Jakarate EE dependencies replace these JEE depdencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Java Transaction API (JTA) --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;javax.transaction&lt;/groupId&gt;
  &lt;artifactId&gt;javax.transaction-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handling-constraint-violations">Handling constraint violations</h5>
<div class="paragraph">
<p>Using <code>@Transactional</code> magically wraps transaction handling around your code.
As constraints are checked by the database at the end when the transaction gets committed, a constraint violation will be thrown by this aspect outside your code.
In case you have to handle constraint violations manually, you have to do that in code outside the logic that is annotated with <code>@Transactional</code>.
This may be done in a <a href="guide-service-layer.asciidoc">service operation</a> by catching a <code>ConstraintViolationException</code> (<code>org.hibernate.exception.ConstraintViolationException</code> for hibernate).
As a generic approach you can solve this via <a href="guide-rest.asciidoc#rest-exception-handling">REST execption handling</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="batches">Batches</h5>
<div class="paragraph">
<p>Transaction control for batches is a lot more complicated and is described in the <a href="guide-batch-layer.asciidoc">batch layer</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<!-- toc disabled -->
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p></p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-16 13:15:53 +0100
</div>
</div>
</body>
</html>